"use strict";(self.webpackChunkblastarians=self.webpackChunkblastarians||[]).push([[5276],{64688:(t,r,e)=>{e.d(r,{S:()=>s});var a=e(54705),n=e(18886);class s{get chainId(){return this._chainId}constructor(t,r,e){(0,a.A)(this,"transfer",(0,n.dt)((()=>{var t=this;return async function(r,e,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0];return t.erc1155.transfer.prepare(r,e,a,n)}})())),(0,a.A)(this,"setApprovalForAll",(0,n.dt)((async(t,r)=>this.erc1155.setApprovalForAll.prepare(t,r)))),(0,a.A)(this,"airdrop",(0,n.dt)((()=>{var t=this;return async function(r,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0];return t.erc1155.airdrop.prepare(r,e,a)}})())),this.contractWrapper=t,this.storage=r,this.erc1155=new n.aL(this.contractWrapper,this.storage,e),this._chainId=e}onNetworkUpdated(t){this.contractWrapper.updateSignerOrProvider(t)}getAddress(){return this.contractWrapper.readContract.address}async get(t){return this.erc1155.get(t)}async totalSupply(t){return this.erc1155.totalSupply(t)}async balanceOf(t,r){return this.erc1155.balanceOf(t,r)}async balance(t){return this.erc1155.balance(t)}async isApproved(t,r){return this.erc1155.isApproved(t,r)}}},32971:(t,r,e)=>{e.d(r,{h:()=>s});var a=e(96337),n=e(18886);async function s(t,r,e){const s=t.getProvider(),o=new n.ds(s,r,a,{},t.storage),c=await t.getSignerAddress(),d=t.address;return(await o.read("allowance",[c,d])).gte(e)}},95276:(t,r,e)=>{e.r(r),e.d(r,{Pack:()=>b});var a=e(54705),n=e(18886),s=e(64688),o=e(96337),c=e(98467),d=e(2776),i=e(73594),p=e(81237),h=e(90789),l=e(97665),u=e(32971);e(3198),e(122),e(75838),e(99038),e(92377),e(6373);const g=l.z.object({contractAddress:n.ab}),w=g.extend({quantity:h.A}),k=g.extend({tokenId:n.a8}),f=g.extend({tokenId:n.a8,quantity:n.a8}),v=w.omit({quantity:!0}).extend({quantityPerReward:h.A}),A=k,W=f.omit({quantity:!0}).extend({quantityPerReward:n.a8}),m=(()=>v.extend({totalRewards:n.a8.default("1")}))(),y=A,R=(()=>W.extend({totalRewards:n.a8.default("1")}))(),C=(()=>l.z.object({erc20Rewards:l.z.array(m).default([]),erc721Rewards:l.z.array(y).default([]),erc1155Rewards:l.z.array(R).default([])}))(),P=(()=>C.extend({packMetadata:h.N,rewardsPerPack:n.a8.default("1"),openStartTime:n.ac.default(new Date)}))();class I{constructor(t,r,e,s,o){(0,a.A)(this,"featureName",n.dT.name),(0,a.A)(this,"open",(0,n.dt)((()=>{var t=this;return async function(r){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e5;return n.aW.fromContractWrapper({contractWrapper:t.contractWrapper,method:"openPack",args:[r,e],overrides:{gasLimit:a},parse:r=>{let e=d.gH.from(0);try{e=t.contractWrapper.parseLogs("PackOpenRequested",null===r||void 0===r?void 0:r.logs)[0].args.requestId}catch(a){}return{receipt:r,id:e}}})}})())),(0,a.A)(this,"claimRewards",(0,n.dt)((()=>{var t=this;return async function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e5;return n.aW.fromContractWrapper({contractWrapper:t.contractWrapper,method:"claimRewards",args:[],overrides:{gasLimit:r},parse:async r=>{const e=t.contractWrapper.parseLogs("PackOpened",null===r||void 0===r?void 0:r.logs);if(0===e.length)throw new Error("PackOpened event not found");const a=e[0].args.rewardUnitsDistributed;return await t.parseRewards(a)}})}})()));let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new n.ds(t,r,c,s,e);this.contractWrapper=i,this.storage=e,this.chainId=o,this.events=new n.aR(this.contractWrapper)}onNetworkUpdated(t){this.contractWrapper.updateSignerOrProvider(t)}getAddress(){return this.contractWrapper.readContract.address}async parseRewards(t){const r=[],e=[],a=[];for(const s of t)switch(s.tokenType){case 0:{const t=await(0,n.bb)(this.contractWrapper.getProvider(),s.assetContract);r.push({contractAddress:s.assetContract,quantityPerReward:i.formatUnits(s.totalAmount,t.decimals).toString()});break}case 1:e.push({contractAddress:s.assetContract,tokenId:s.tokenId.toString()});break;case 2:a.push({contractAddress:s.assetContract,tokenId:s.tokenId.toString(),quantityPerReward:s.totalAmount.toString()})}return{erc20Rewards:r,erc721Rewards:e,erc1155Rewards:a}}async addPackOpenEventListener(t){return this.events.addEventListener("PackOpened",(async r=>{t(r.data.packId.toString(),r.data.opener,await this.parseRewards(r.data.rewardUnitsDistributed))}))}async canClaimRewards(t){const r=await(0,n.cG)(t||await this.contractWrapper.getSignerAddress());return await this.contractWrapper.readContract.canClaimRewards(r)}async openAndClaim(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e5;const a=await this.contractWrapper.sendTransaction("openPackAndClaimRewards",[t,r,e],{gasLimit:d.gH.from(5e5)});let n=d.gH.from(0);try{n=this.contractWrapper.parseLogs("PackOpenRequested",null===a||void 0===a?void 0:a.logs)[0].args.requestId}catch(s){}return{receipt:a,id:n}}async getLinkBalance(){return this.getLinkContract().balanceOf(this.contractWrapper.readContract.address)}async transferLink(t){await this.getLinkContract().transfer(this.contractWrapper.readContract.address,t)}getLinkContract(){const t=n.cU[this.chainId];if(!t)throw new Error("No LINK token address found for chainId ".concat(this.chainId));const r=new n.ds(this.contractWrapper.getSignerOrProvider(),t,o,this.contractWrapper.options,this.storage);return new n.au(r,this.storage,this.chainId)}}class b extends s.S{get vrf(){return(0,n.cc)(this._vrf,n.dT)}constructor(t,r,e){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0;super(arguments.length>6&&void 0!==arguments[6]?arguments[6]:new n.ds(t,r,o,s.gasless&&"openzeppelin"in s.gasless?{...s,gasless:{...s.gasless,openzeppelin:{...s.gasless.openzeppelin,useEOAForwarder:!0}}}:s,e),e,c),(0,a.A)(this,"create",(0,n.dt)((async t=>{const r=await this.contractWrapper.getSignerAddress();return this.createTo.prepare(r,t)}))),(0,a.A)(this,"addPackContents",(0,n.dt)((async(t,r)=>{const e=await this.contractWrapper.getSignerAddress(),a=await C.parseAsync(r),{contents:s,numOfRewardUnits:o}=await this.toPackContentArgs(a);return n.aW.fromContractWrapper({contractWrapper:this.contractWrapper,method:"addPackContents",args:[t,s,o,e],parse:t=>{const r=this.contractWrapper.parseLogs("PackUpdated",null===t||void 0===t?void 0:t.logs);if(0===r.length)throw new Error("PackUpdated event not found");const e=r[0].args.packId;return{id:e,receipt:t,data:()=>this.erc1155.get(e)}}})}))),(0,a.A)(this,"createTo",(0,n.dt)((async(t,r)=>{const e=await(0,n.dQ)(r.packMetadata,this.storage),a=await P.parseAsync(r),{erc20Rewards:s,erc721Rewards:o,erc1155Rewards:c}=a,d={erc20Rewards:s,erc721Rewards:o,erc1155Rewards:c},{contents:i,numOfRewardUnits:p}=await this.toPackContentArgs(d);return n.aW.fromContractWrapper({contractWrapper:this.contractWrapper,method:"createPack",args:[i,p,e,a.openStartTime,a.rewardsPerPack,await(0,n.cG)(t)],parse:t=>{const r=this.contractWrapper.parseLogs("PackCreated",null===t||void 0===t?void 0:t.logs);if(0===r.length)throw new Error("PackCreated event not found");const e=r[0].args.packId;return{id:e,receipt:t,data:()=>this.erc1155.get(e)}}})}))),(0,a.A)(this,"open",(0,n.dt)((()=>{var t=this;return async function(r){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e5;if(t._vrf)throw new Error("This contract is using Chainlink VRF, use `contract.vrf.open()` or `contract.vrf.openAndClaim()` instead");return n.aW.fromContractWrapper({contractWrapper:t.contractWrapper,method:"openPack",args:[r,e],overrides:{gasLimit:a},parse:async r=>{const e=t.contractWrapper.parseLogs("PackOpened",null===r||void 0===r?void 0:r.logs);if(0===e.length)throw new Error("PackOpened event not found");const a=e[0].args.rewardUnitsDistributed,s=[],o=[],c=[];for(const d of a)switch(d.tokenType){case 0:{const r=await(0,n.bb)(t.contractWrapper.getProvider(),d.assetContract);s.push({contractAddress:d.assetContract,quantityPerReward:i.formatUnits(d.totalAmount,r.decimals).toString()});break}case 1:o.push({contractAddress:d.assetContract,tokenId:d.tokenId.toString()});break;case 2:c.push({contractAddress:d.assetContract,tokenId:d.tokenId.toString(),quantityPerReward:d.totalAmount.toString()})}return{erc20Rewards:s,erc721Rewards:o,erc1155Rewards:c}}})}})())),this.abi=n.e.parse(o||[]),this.metadata=new n.ah(this.contractWrapper,n.dV,this.storage),this.app=new n.b0(this.contractWrapper,this.metadata,this.storage),this.roles=new n.ai(this.contractWrapper,b.contractRoles),this.royalties=new n.aj(this.contractWrapper,this.metadata),this.encoder=new n.ag(this.contractWrapper),this.estimator=new n.aQ(this.contractWrapper),this.events=new n.aR(this.contractWrapper),this.interceptor=new n.aS(this.contractWrapper),this.owner=new n.aV(this.contractWrapper),this._vrf=this.detectVrf()}onNetworkUpdated(t){var r;this.contractWrapper.updateSignerOrProvider(t),null===(r=this._vrf)||void 0===r||r.onNetworkUpdated(t)}getAddress(){return this.contractWrapper.readContract.address}async get(t){return this.erc1155.get(t)}async getAll(t){return this.erc1155.getAll(t)}async getOwned(t){return this.erc1155.getOwned(t)}async getTotalCount(){return this.erc1155.totalCount()}async isTransferRestricted(){return!await this.contractWrapper.readContract.hasRole((0,n.bI)("transfer"),p.L)}async getPackContents(t){const{contents:r,perUnitAmounts:e}=await this.contractWrapper.readContract.getPackContents(t),a=[],s=[],o=[];for(let c=0;c<r.length;c++){const t=r[c],p=e[c];switch(t.tokenType){case 0:{const r=await(0,n.bb)(this.contractWrapper.getProvider(),t.assetContract),e=i.formatUnits(p,r.decimals),s=i.formatUnits(d.gH.from(t.totalAmount).div(p),r.decimals);a.push({contractAddress:t.assetContract,quantityPerReward:e,totalRewards:s});break}case 1:s.push({contractAddress:t.assetContract,tokenId:t.tokenId.toString()});break;case 2:o.push({contractAddress:t.assetContract,tokenId:t.tokenId.toString(),quantityPerReward:p.toString(),totalRewards:d.gH.from(t.totalAmount).div(p).toString()})}}return{erc20Rewards:a,erc721Rewards:s,erc1155Rewards:o}}async toPackContentArgs(t){const r=[],e=[],{erc20Rewards:a,erc721Rewards:s,erc1155Rewards:o}=t,c=this.contractWrapper.getProvider(),i=await this.contractWrapper.getSignerAddress();for(const d of a){const t=(await(0,n.ba)(c,d.quantityPerReward,d.contractAddress)).mul(d.totalRewards);if(!await(0,u.h)(this.contractWrapper,d.contractAddress,t))throw new Error('ERC20 token with contract address "'.concat(d.contractAddress,'" does not have enough allowance to transfer.\n\nYou can set allowance to the multiwrap contract to transfer these tokens by running:\n\nawait sdk.getToken("').concat(d.contractAddress,'").setAllowance("').concat(this.getAddress(),'", ').concat(t,");\n\n"));e.push(d.totalRewards),r.push({assetContract:d.contractAddress,tokenType:0,totalAmount:t,tokenId:0})}for(const d of s){if(!await(0,n.dC)(this.contractWrapper.getProvider(),this.getAddress(),d.contractAddress,d.tokenId,i))throw new Error('ERC721 token "'.concat(d.tokenId,'" with contract address "').concat(d.contractAddress,'" is not approved for transfer.\n\nYou can give approval the multiwrap contract to transfer this token by running:\n\nawait sdk.getNFTCollection("').concat(d.contractAddress,'").setApprovalForToken("').concat(this.getAddress(),'", ').concat(d.tokenId,");\n\n"));e.push("1"),r.push({assetContract:d.contractAddress,tokenType:1,totalAmount:1,tokenId:d.tokenId})}for(const p of o){if(!await(0,n.dC)(this.contractWrapper.getProvider(),this.getAddress(),p.contractAddress,p.tokenId,i))throw new Error('ERC1155 token "'.concat(p.tokenId,'" with contract address "').concat(p.contractAddress,'" is not approved for transfer.\n\nYou can give approval the multiwrap contract to transfer this token by running:\n\nawait sdk.getEdition("').concat(p.contractAddress,'").setApprovalForAll("').concat(this.getAddress(),'", true);\n\n'));e.push(p.totalRewards),r.push({assetContract:p.contractAddress,tokenType:2,totalAmount:d.gH.from(p.quantityPerReward).mul(d.gH.from(p.totalRewards)),tokenId:p.tokenId})}return{contents:r,numOfRewardUnits:e}}async prepare(t,r,e){return n.aW.fromContractWrapper({contractWrapper:this.contractWrapper,method:t,args:r,overrides:e})}async call(t,r,e){return this.contractWrapper.call(t,r,e)}detectVrf(){if((0,n.cd)(this.contractWrapper,"PackVRF"))return new I(this.contractWrapper.getSignerOrProvider(),this.contractWrapper.readContract.address,this.storage,this.contractWrapper.options,this.chainId)}}(0,a.A)(b,"contractRoles",n.dU)}}]);
//# sourceMappingURL=5276.2213ee07.chunk.js.map